<!doctype html><html lang=ja-jp><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>意図しないrmを回避するためのbashrc - 横あるき</title><meta name=description content="変なことを書き綴るサイトです。"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=152x152 href=/favicons/152x152.png><link rel=icon type=image/png sizes=192x192 href=/favicons/192x192.png><meta name=msapplication-config content="https://kuno.kdns.info/browserconfig.xml"><link rel=stylesheet href="/style.css?d=20210606164936"><meta property="og:title" content="意図しないrmを回避するためのbashrc"><meta property="og:description" content="皆さん、楽しいターミナルライフしてますか？ 先日、私は不注意なrmを実行したことで、フォルダのPicturesとDocumentsがあべししま"><meta property="og:type" content="article"><meta property="og:url" content="https://kuno.kdns.info/2016/08/confirm-rm/"><meta property="og:image" content="https://kuno.kdns.info/favicons/310x310.png"><meta property="article:published_time" content="2016-08-07T09:45:30+09:00"><meta property="article:modified_time" content="2016-08-07T09:45:30+09:00"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://kuno.kdns.info/favicons/310x310.png"><meta name=twitter:title content="意図しないrmを回避するためのbashrc"><meta name=twitter:description content="皆さん、楽しいターミナルライフしてますか？ 先日、私は不注意なrmを実行したことで、フォルダのPicturesとDocumentsがあべししま"><meta name=twitter:site content="@knokmki612"></head><body class=site-body><script src=https://unpkg.com/swup/dist/swup.min.js defer></script><script src=https://unpkg.com/@swup/scroll-plugin/dist/SwupScrollPlugin.min.js defer></script><script src=https://unpkg.com/@swup/preload-plugin/dist/SwupPreloadPlugin.min.js defer></script><script src=/index.js defer></script><header class=site-header><div class=inner><h1><a href=/>横あるき</a></h1><p>変なことを書き綴るサイトです。</p><p class=text-browser-message><a href=#main>本文に移動</a></p></div></header><nav class=site-global-menu><ul><li><a href=/about/>私について</a></li><li><a href=/product/>作ったもの</a></li></ul></nav><div class=site-search><form class=inner method=get action=https://duckduckgo.com><input class=search-input type=search name=q placeholder=DuckDuckGoで記事検索 aria-label=語句を入力して記事を検索>
<input type=hidden name=sites value=https://kuno.kdns.info/>
<button class=search-button type=submit>
<img src=/search.svg alt=検索></button></form></div><main id=swup class=site-main><hr id=main class=text-browser-message><article class=site-article><header class=article-header><h2>意図しないrmを回避するためのbashrc</h2><aside class=article-aside><div class=aside-row><div class=aside-column><span>公開日</span>
<time datetime=2016-08-07T09:45:30+09:00>2016/08/07</time></div></div><div class=aside-row><div class=aside-column><span>タグ</span>
<span><a href=/tags/tips/>Tips</a></span></div></div><div class=social-button><a class="button is-twitter" href="http://twitter.com/share?url=https%3a%2f%2fkuno.kdns.info%2f2016%2f08%2fconfirm-rm%2f&text=%e6%84%8f%e5%9b%b3%e3%81%97%e3%81%aa%e3%81%84rm%e3%82%92%e5%9b%9e%e9%81%bf%e3%81%99%e3%82%8b%e3%81%9f%e3%82%81%e3%81%aebashrc&nbsp;-&nbsp;%e6%a8%aa%e3%81%82%e3%82%8b%e3%81%8d" target=_blank rel="noopener noreferrer"><img src=/twitter.svg alt=Twitter>ツイート
</a><a class="button is-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fkuno.kdns.info%2f2016%2f08%2fconfirm-rm%2f" target=_blank rel="noopener noreferrer"><img src=/facebook.svg alt=Facebook>シェア
</a><a class="button is-hatenabookmark" href=http://b.hatena.ne.jp/entry/https://kuno.kdns.info/2016/08/confirm-rm/ target=_blank rel="noopener noreferrer"><img src=/hatenabookmark.svg alt=はてなブックマーク>ブックマーク</a></div></aside></header><p>皆さん、楽しいターミナルライフしてますか？</p><br><p>先日、私は不注意なrmを実行したことで、フォルダのPicturesとDocumentsがあべししました。写真はバックアップをとってありますし、Documentsに入っていたものも消えても問題ないかバックアップをしてあったので被害は少なかったのですが、それにしたってちょっと雑過ぎるダンシャリ過ぎました。ショックです。</p><p>もうこんな過ちを犯すのはごめんなので、rmを実行したら確認のワンクッションを置けるaliasをbashrcに書いてみました。</p><pre><code>confirm_rm() {
    echo &quot;rm $@&quot;
    echo &quot;are you sure you want to remove these files?&quot;
    while true; do
        echo -n '(y/n): '
        read res
        if echo &quot;$res&quot; | grep '^[yn]$' 2&gt;&amp;1 &gt;/dev/null; then
            break
        fi
    done
    if [ &quot;$res&quot; = y ]; then
        \rm &quot;$@&quot;
    else
        echo 'these files were saved!'
    fi
}

alias rm=&quot;confirm_rm&quot;
</code></pre><p>rmを実行しようとしたら、もう一度実行内容を確認します。ワイルドカードを使っていたら展開されて消される対象のファイルやフォルダがずらっと出てきます。</p><pre><code>$ ls 消したくないフォルダ/
消したくないファイル1  消したくないファイル3  消したくないファイル5
消したくないファイル2  消したくないファイル4
$
</code></pre><pre><code>$ rm 消したくないフォルダ/*
rm 消したくないフォルダ/消したくないファイル1 消したくないフォルダ/消したくないファイル2 消したくないフォルダ/消したくないファイル3 消したくないフォルダ/消したくないファイル4 消したくないフォルダ/消したくないファイル5
are you sure you want to remove these files?
(y/n): n
these files were saved!
$
</code></pre><p>本当に消してよい覚悟があるならy、ないならnを入力して、本来なら消えるはずだったものを救済しましょう！</p><pre><code>$ rm -rf /*
rm -rf /bin /boot /dev /etc /home /lib /lib32 /lib64 /lost+found /media /mnt /opt /portage-latest.tar.bz2 /proc /root /run /sbin /srv /stage3-amd64-20151203.tar.bz2 /sys /tmp /usr /var
are you sure you want to remove these files?
(y/n): n
these files were saved!
$
</code></pre><p>あくまで実行する前に確認するだけなので、ないものを消そうとしたり権限が足りなくて消せないはずでも確認します。だるいでしょうけど仕方ないですね。</p><p>ぶっちゃけこんなダイアログ的にしなくても、もっと簡単に同じことが出来ますけどね。aliasはコマンドの頭にバックスラッシュを書けば一時的に無効化されるそうです。最初に紹介したやつもこれを利用しています。(参考にしたもの:<a href=http://www.atmarkit.co.jp/flinux/rensai/linuxtips/214dsblalas.html>エイリアスを一時的に無効にするには</a>)</p><pre><code>$ alias rm=&quot;echo rm&quot;
$ rm 消したくないフォルダ/*
rm 消したくないフォルダ/消したくないファイル1 消したくないフォルダ/消したくないファイル2 消したくないフォルダ/消したくないファイル3 消したくないフォルダ/消したくないファイル4 消したくないフォルダ/消したくないファイル5
$ \rm 消したくないフォルダ/*
$
</code></pre><br><p>確認メッセージの英語おかしかったらツッコんで下さい。新幹線で書いてるんですけど、広島行ってきます！では！</p></article></main><nav class=site-side-menu><div class=inner><section class="menu-section is-width-100pct"><h2>フィード</h2><a class=feed-button href=/blog/index.xml><img src=/rss.svg alt=フィード></a></section><section class="menu-section is-width-50pct"><h2><a href=/tags/>タグ</a></h2><ul><li><a href=https://kuno.kdns.info/tags/%E6%97%A5%E8%A8%98/>日記</a> (30)</li><li><a href=https://kuno.kdns.info/tags/oss-gate/>OSS Gate</a> (14)</li><li><a href=https://kuno.kdns.info/tags/%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC/>レビュー</a> (12)</li><li><a href=https://kuno.kdns.info/tags/%E3%82%AC%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88/>ガジェット</a> (9)</li><li><a href=https://kuno.kdns.info/tags/sailfish-os/>Sailfish OS</a> (8)</li><li><a href=https://kuno.kdns.info/tags/tips/>Tips</a> (7)</li><li><a href=https://kuno.kdns.info/tags/jolla/>Jolla</a> (6)</li><li><a href=https://kuno.kdns.info/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/>お知らせ</a> (5)</li><li><a href=https://kuno.kdns.info/tags/%E6%98%A0%E7%94%BB/>映画</a> (3)</li><li><a href=https://kuno.kdns.info/tags/%E9%9B%91%E8%A8%98/>雑記</a> (3)</li><li><a href=https://kuno.kdns.info/tags/%E6%94%BE%E9%80%81%E5%A4%A7%E5%AD%A6/>放送大学</a> (2)</li><li><a href=https://kuno.kdns.info/tags/vim/>Vim</a> (1)</li><li><a href=https://kuno.kdns.info/tags/windows/>Windows</a> (1)</li><li><a href=https://kuno.kdns.info/tags/%E3%82%A8%E3%83%A2%E3%81%84/>エモい</a> (1)</li><li><a href=https://kuno.kdns.info/tags/%E6%9C%AC/>本</a> (1)</li></ul></section><section class="menu-section is-width-50pct"><h2><a href=/archives/>アーカイブ</a></h2><ul><li><a href=https://kuno.kdns.info/archives/2021-06/>2021-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2021/>2021</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2020-06/>2020-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2020/>2020</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019-06/>2019-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019-04/>2019-04</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019/>2019</a> (2)</li><li><a href=https://kuno.kdns.info/archives/2018-12/>2018-12</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2018-11/>2018-11</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2018-09/>2018-09</a> (4)</li></ul></section></div></nav><footer class=site-footer><div class=inner><p>&copy; 2015 knokmki612</p></div></footer></body></html>