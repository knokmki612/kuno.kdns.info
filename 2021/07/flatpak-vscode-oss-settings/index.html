<!doctype html><html lang=ja-jp><head><meta name=generator content="Hugo 0.85.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>FlatpakのVSCode(OSS)のリポジトリが移行していて試したらLive Shareも使えた - 横あるき</title><meta name=description content="変なことを書き綴るサイトです。"><link rel=icon type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon type=image/png sizes=152x152 href=/favicons/152x152.png><link rel=icon type=image/png sizes=192x192 href=/favicons/192x192.png><meta name=msapplication-config content="https://kuno.kdns.info/browserconfig.xml"><link rel=stylesheet href="/style.css?d=20210721084806"><meta property="og:title" content="FlatpakのVSCode(OSS)のリポジトリが移行していて試したらLive Shareも使えた"><meta property="og:description" content="以前試した際は、Live Shareに必要なライブラリ群がFlatpakパッケージに含まれていなかったからなのかなんなのか分からないけど、動作"><meta property="og:type" content="article"><meta property="og:url" content="https://kuno.kdns.info/2021/07/flatpak-vscode-oss-settings/"><meta property="og:image" content="https://kuno.kdns.info/favicons/310x310.png"><meta property="article:published_time" content="2021-07-20T01:12:52+09:00"><meta property="article:modified_time" content="2021-07-20T01:12:52+09:00"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://kuno.kdns.info/favicons/310x310.png"><meta name=twitter:title content="FlatpakのVSCode(OSS)のリポジトリが移行していて試したらLive Shareも使えた"><meta name=twitter:description content="以前試した際は、Live Shareに必要なライブラリ群がFlatpakパッケージに含まれていなかったからなのかなんなのか分からないけど、動作"><meta name=twitter:site content="@knokmki612"></head><body class=site-body><script src=https://unpkg.com/swup/dist/swup.min.js defer></script><script src=https://unpkg.com/@swup/scroll-plugin/dist/SwupScrollPlugin.min.js defer></script><script src=https://unpkg.com/@swup/preload-plugin/dist/SwupPreloadPlugin.min.js defer></script><script src=/index.js defer></script><header class=site-header><div class=inner><h1><a href=/>横あるき</a></h1><p>変なことを書き綴るサイトです。</p><p class=text-browser-message><a href=#main>本文に移動</a></p></div></header><nav class=site-global-menu><ul><li><a href=/about/>私について</a></li><li><a href=/product/>作ったもの</a></li></ul></nav><div class=site-search><form class=inner method=get action=https://duckduckgo.com><input class=search-input type=search name=q placeholder=DuckDuckGoで記事検索 aria-label=語句を入力して記事を検索>
<input type=hidden name=sites value=https://kuno.kdns.info/>
<button class=search-button type=submit>
<img src=/search.svg alt=検索></button></form></div><main id=swup class=site-main><hr id=main class=text-browser-message><article class=site-article><header class=article-header><h2>FlatpakのVSCode(OSS)のリポジトリが移行していて試したらLive Shareも使えた</h2><aside class=article-aside><div class=aside-row><div class=aside-column><span>公開日</span>
<time datetime=2021-07-20T01:12:52+09:00>2021/07/20</time></div><div class=aside-column><span>発生日</span>
<time datetime=2021-07-20>2021/07/20</time></div></div><div class=aside-row><div class=aside-column><span>タグ</span>
<span><a href=/tags/%E6%97%A5%E8%A8%98/>日記</a>, <a href=/tags/tips/>Tips</a></span></div></div><div class=social-button><a class="button is-twitter" href="http://twitter.com/share?url=https%3a%2f%2fkuno.kdns.info%2f2021%2f07%2fflatpak-vscode-oss-settings%2f&text=Flatpak%e3%81%aeVSCode%28OSS%29%e3%81%ae%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%8c%e7%a7%bb%e8%a1%8c%e3%81%97%e3%81%a6%e3%81%84%e3%81%a6%e8%a9%a6%e3%81%97%e3%81%9f%e3%82%89Live%20Share%e3%82%82%e4%bd%bf%e3%81%88%e3%81%9f&nbsp;-&nbsp;%e6%a8%aa%e3%81%82%e3%82%8b%e3%81%8d" target=_blank rel="noopener noreferrer"><img src=/twitter.svg alt=Twitter>ツイート
</a><a class="button is-facebook" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fkuno.kdns.info%2f2021%2f07%2fflatpak-vscode-oss-settings%2f" target=_blank rel="noopener noreferrer"><img src=/facebook.svg alt=Facebook>シェア
</a><a class="button is-hatenabookmark" href=http://b.hatena.ne.jp/entry/https://kuno.kdns.info/2021/07/flatpak-vscode-oss-settings/ target=_blank rel="noopener noreferrer"><img src=/hatenabookmark.svg alt=はてなブックマーク>ブックマーク</a></div></aside></header><p>以前試した際は、<a href=https://docs.microsoft.com/ja-jp/visualstudio/liveshare/reference/linux#tips-for-community-supported-distros>Live Shareに必要なライブラリ群</a>が<a href=https://github.com/flathub/com.visualstudio.code.oss/issues/11>Flatpakパッケージに含まれていなかった</a>からなのか<a href=https://github.com/flathub/com.visualstudio.code.oss/pull/31>なんなのか</a>分からないけど、動作に問題があるように感じ、別途Fedora SilverblueではLocal Packageをインストールしていた。これをしてしまうと、バージョンアップごとに <code>rpm-ostree install &lt;ダウンロードしたrpmパッケージ></code> とやる必要があり面倒くさい。</p><p>今週ふと「またFlatpakのVSCodeパッケージ試してみよう」と思ってOSS版のリポジトリを確認したら、<a href=https://github.com/flathub/com.visualstudio.code.oss/>以前のリポジトリ</a>はアーカイブされていて、<a href=https://github.com/flathub/com.visualstudio.code-oss>新しいリポジトリ</a>に移行していた。</p><p>リポジトリの移行に関連するのか分からないけど、Flatpakパッケージのパッケージングは<a href=https://docs.flatpak.org/en/latest/manifests.html>YAMLで書かれたマニフェストファイルで定義できる</a>ようになっているみたいで、Flatpakパッケージのパッケージングに興味が出てきた。</p><p>初回起動時にFlatpak版特有のドキュメンテーション(実行環境の拡張、ターミナル連携の設定等)が表示される。ターミナル連携の設定がdeprecatedになっていたので、新しい書き方で<a href=https://github.com/gasinvein/vscode-flatpak-wrapper/pull/8>PR</a>を出した(すぐレビューしてもらえてありがたかった)</p><p>また、自分はFedora Silverblueを使っているのでtoolboxのコンテナー環境をターミナルで使うことができ、以下のように設定した。フォントの設定もしているけどデフォルトだとひどい等幅フォントが使われていたので、よく使う <code>Dejavu Sans Mono</code> にした。</p><p>事前にコンテナー環境を作るのは <code>toolbox create vscode</code> をした。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;terminal.integrated.profiles.linux&#34;</span>: {
        <span style=color:#f92672>&#34;toolbox&#34;</span>: {
            <span style=color:#f92672>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/flatpak-spawn&#34;</span>,
            <span style=color:#f92672>&#34;args&#34;</span>:  [<span style=color:#e6db74>&#34;--host&#34;</span>, <span style=color:#e6db74>&#34;toolbox&#34;</span>, <span style=color:#e6db74>&#34;enter&#34;</span>, <span style=color:#e6db74>&#34;vscode&#34;</span>]
        }
    },
    <span style=color:#f92672>&#34;terminal.integrated.defaultProfile.linux&#34;</span>: <span style=color:#e6db74>&#34;toolbox&#34;</span>,
    <span style=color:#f92672>&#34;terminal.integrated.fontFamily&#34;</span>: <span style=color:#e6db74>&#34;Dejavu Sans Mono&#34;</span>
}
</code></pre></div><p>拡張機能をインストールしようとして接続エラーが出てインストールできないので調べたら、デフォルトでは<a href=https://open-vsx.org/>オープンプラットフォームなマーケットプレイス</a>が設定されているみたい。(なぜ接続エラーがでるのかは分かっていない。issueを立てた方が良さそう)</p><p>使用するマーケットプレイスを変更する方法は<a href=https://github.com/flathub/com.visualstudio.code-oss/issues/11#issuecomment-782694865>このコメント</a>と<a href=https://github.com/flathub/com.visualstudio.code-oss/issues/11#issuecomment-782695241>このコメント</a>にしたがう。</p><p><code>$HOME/.var/app/com.visualstudio.code-oss/config/product.json</code> にVSCodeのマーケットプレイスを使う設定を書く。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;serviceUrl&#34;</span>: <span style=color:#e6db74>&#34;https://marketplace.visualstudio.com/_apis/public/gallery&#34;</span>,
  <span style=color:#f92672>&#34;itemUrl&#34;</span>: <span style=color:#e6db74>&#34;https://marketplace.visualstudio.com/items&#34;</span>
}
</code></pre></div><p>環境変数で先ほど書いたものを渡す。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ flatpak --user override --env<span style=color:#f92672>=</span>VSCODE_EXTENSIONS_GALLERY<span style=color:#f92672>=</span>$HOME/.var/app/com.visualstudio.code-oss/config/product.json com.visualstudio.code-oss
</code></pre></div><p>これでESLint、Prettier、Live Shareなどの拡張機能が入れられるようになった。</p><p>Live ShareはVSCodeの起動時に毎回「We were unable to install support for joining sessions using a browser link. You may be missing key Linux libraries. Install them now?」とダイアログが表示されるが、これを「Cancel」して普通にセッションを開始することができた。ダイアログが表示されないようにしたいが分からない(issueを立てた方が良さそう)</p></article></main><nav class=site-side-menu><div class=inner><section class="menu-section is-width-100pct"><h2>フィード</h2><a class=feed-button href=/blog/index.xml><img src=/rss.svg alt=フィード></a></section><section class="menu-section is-width-50pct"><h2><a href=/tags/>タグ</a></h2><ul><li><a href=https://kuno.kdns.info/tags/%E6%97%A5%E8%A8%98/>日記</a> (31)</li><li><a href=https://kuno.kdns.info/tags/oss-gate/>OSS Gate</a> (14)</li><li><a href=https://kuno.kdns.info/tags/%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC/>レビュー</a> (12)</li><li><a href=https://kuno.kdns.info/tags/%E3%82%AC%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88/>ガジェット</a> (9)</li><li><a href=https://kuno.kdns.info/tags/sailfish-os/>Sailfish OS</a> (8)</li><li><a href=https://kuno.kdns.info/tags/tips/>Tips</a> (8)</li><li><a href=https://kuno.kdns.info/tags/jolla/>Jolla</a> (6)</li><li><a href=https://kuno.kdns.info/tags/%E3%81%8A%E7%9F%A5%E3%82%89%E3%81%9B/>お知らせ</a> (5)</li><li><a href=https://kuno.kdns.info/tags/%E6%98%A0%E7%94%BB/>映画</a> (3)</li><li><a href=https://kuno.kdns.info/tags/%E9%9B%91%E8%A8%98/>雑記</a> (3)</li><li><a href=https://kuno.kdns.info/tags/%E6%94%BE%E9%80%81%E5%A4%A7%E5%AD%A6/>放送大学</a> (2)</li><li><a href=https://kuno.kdns.info/tags/vim/>Vim</a> (1)</li><li><a href=https://kuno.kdns.info/tags/windows/>Windows</a> (1)</li><li><a href=https://kuno.kdns.info/tags/%E3%82%A8%E3%83%A2%E3%81%84/>エモい</a> (1)</li><li><a href=https://kuno.kdns.info/tags/%E6%9C%AC/>本</a> (1)</li></ul></section><section class="menu-section is-width-50pct"><h2><a href=/archives/>アーカイブ</a></h2><ul><li><a href=https://kuno.kdns.info/archives/2021-07/>2021-07</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2021-06/>2021-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2021/>2021</a> (2)</li><li><a href=https://kuno.kdns.info/archives/2020-06/>2020-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2020/>2020</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019-06/>2019-06</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019-04/>2019-04</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2019/>2019</a> (2)</li><li><a href=https://kuno.kdns.info/archives/2018-12/>2018-12</a> (1)</li><li><a href=https://kuno.kdns.info/archives/2018-11/>2018-11</a> (1)</li></ul></section></div></nav><footer class=site-footer><div class=inner><p>&copy; 2015 knokmki612</p></div></footer></body></html>